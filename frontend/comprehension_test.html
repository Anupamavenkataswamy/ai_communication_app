<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Comprehension Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f5f5f5;
    }

    h3 {
      color: #007acc;
    }

    .section {
      background-color: white;
      margin-bottom: 10px;
      border-left: 5px solid transparent;
      padding: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: 0.3s;
      cursor: pointer;
    }

    .section:hover {
      background-color: #f9f9f9;
    }

    .section.active {
      background-color: #fff3cd;
      border-left: 5px solid #ffc107;
    }

    .title {
      font-weight: bold;
      font-size: 16px;
    }

    .attempted {
      color: #666;
      font-size: 14px;
    }

    .disabled {
      opacity: 0.5;
      pointer-events: none;
    }
  </style>
</head>
<body>

  <h3>📘 Instructions</h3>
  <h4>Sections</h4>

  <div class="section" id="audioSection" onclick="selectSection('audio')">
    <div class="title">01. Audio Comprehension</div>
    <div class="attempted" id="audioAttempts">00 / 05 attempted</div>
  </div>

  <div class="section" id="textSection" onclick="selectSection('text')">
    <div class="title">02. Text Comprehension</div>
    <div class="attempted" id="textAttempts">00 / 05 attempted</div>
  </div>

  <script>
    // Step 1: Get user info from localStorage
    const username = localStorage.getItem("username") || "guest";
    const userKey = `userAttempt_${username}`;

    const userAttemptData = JSON.parse(localStorage.getItem(userKey)) || {
      attempted: false,
      audioAttempted: 0,
      textAttempted: 0
    };

    // Step 2: Disable sections if already attempted
    if (userAttemptData.attempted) {
      document.getElementById("audioSection").classList.add("disabled");
      document.getElementById("textSection").classList.add("disabled");
      alert("⚠️ You have already completed the assessment. Only one attempt is allowed.");
    }

    // Step 3: Update UI based on attempt count
    document.getElementById("audioAttempts").innerText = `${String(userAttemptData.audioAttempted).padStart(2, '0')} / 05 attempted`;
    document.getElementById("textAttempts").innerText = `${String(userAttemptData.textAttempted).padStart(2, '0')} / 05 attempted`;

    function selectSection(section) {
      if (userAttemptData.attempted) {
        alert("🚫 You have already completed your attempt.");
        return;
      }

      // Optional: track section attempt counts (if desired)
      if (section === 'audio') {
        userAttemptData.audioAttempted = 5;
        localStorage.setItem("audioAttempted", 5);
        window.location.href = 'audio_comprehension.html';
      } else if (section === 'text') {
        userAttemptData.textAttempted = 5;
        localStorage.setItem("textAttempted", 5);
        window.location.href = 'text_comprehension.html';
      }

      // If both done, lock user
      if (userAttemptData.audioAttempted >= 5 && userAttemptData.textAttempted >= 5) {
        userAttemptData.attempted = true;
      }

      localStorage.setItem(userKey, JSON.stringify(userAttemptData));
    }
  </script>
</body>
</html>
